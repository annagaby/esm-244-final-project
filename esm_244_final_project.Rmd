---
title: "esm_244_final_project"
author: "Anna Calle"
date: "2/3/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Data wrangling for Snowy Plover tab
```{r}
# Load packages and read Snowy Plover csv file

library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(gganimate)
library(lubridate)
snowyplover <- read_csv("SnowyPlover.csv")

```


```{r}
# Count table filtered by specific year
predation <- snowyplover %>% 
  select(year, failure_cause) %>% 
  filter( failure_cause != "NA") %>%
  filter( year == "2015") %>% 
  count(failure_cause, year) %>%
  arrange(-n) %>% 
  mutate( failure_cause = factor(failure_cause, levels = failure_cause))

# Graph using filtered count table
predators_graph <- ggplot(predation, aes( x = failure_cause, y = n)) +
  geom_col() +
  xlab("Predator") +
      ylab("Number of Predated Nests") +
      scale_y_continuous(limits = c(0,20), breaks = c(0,5,10,15,20)) +
      theme_classic()

predators_graph2
```


```{r}
# Data wrangling with Snowy Ploverbreeding data

breeding <- snowyplover %>% 
  select( year, total_eggs, eggs_hatched, chicks_fledged) %>% 
  mutate( nests = 1)
 
# Removing NA, ".", ?, and uncomfirmed
breeding[is.na(breeding)] <- 0
breeding[ breeding == "." | breeding == "unconfirmed" | breeding == "?"] <- 0

# Coerce to numeric class
breeding = as.data.frame(sapply(breeding, as.numeric))

# Creating count table by year and by breeding stage

breeding_table <- breeding %>% 
  group_by(year) %>% 
  summarise( nests = sum(nests), eggs = sum(total_eggs), hatched = sum(eggs_hatched), fledged = sum(chicks_fledged)) %>% 
  gather("stage", "count", 2:5)


# Graph
breeding_graph <- ggplot(breeding_table, aes(x = year, y = count, group = stage)) +
  geom_line(aes(color = stage)) +
  theme_classic() +
  geom_point( aes(color = stage)) +
  transition_reveal(year)
breeding_graph

```
  

```{r}

shorebirds <- read_csv("COPR_Shorebird.csv")
#read shorebird data

```


```{r}

#Shorebird abundance by location for 2015

bird_2015 <- shorebirds %>% 
    filter(Year == "2015") #Filter data set by year (use radio buttons or drop down menu to select)

bird_2015_graph <- ggplot(bird_2015, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number Observed", title = "Shorebird Abundance at COPR (2015)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #histogram for locations of where shorebirds were found in beach polygons

#Maybe add a map to this page of polygons

bird_2015_graph

```


```{r}
#Shorebird abundance by location for 2015

bird_2016 <- shorebirds %>% 
    filter(Year == "2016") #Filter data set by year (use radio buttons or drop down menu to select)

bird_2016_graph <- ggplot(bird_2016, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number Observed", title = "Shorebird Abundance at COPR (2016)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #histogram for locations of where shorebirds were found in beach polygons

#Maybe add a map to this page of polygons

bird_2016_graph

```


```{r}

#Shorebird abundance by location for 2015

bird_2017 <- shorebirds %>% 
    filter(Year == "2017") #Filter data set by year (use radio buttons or drop down menu to select)

bird_2017_graph <- ggplot(bird_2015, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number Observed", title = "Shorebird Abundance at COPR (2017)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #histogram for locations of where shorebirds were found in beach polygons

#Maybe add a map to this page of polygons

bird_2017_graph

```


```{r}
#Add code for 2018 dat here when we have it

```


```{r}
#Shorebird diversity by location for 2015

bird_2015_sp <- shorebirds %>% 
    filter(Year == "2015") %>% #Filter data set by year (use radio buttons or drop down menu to select)
  group_by(Species) %>% 
  count(Polygon_Location, Species) #Turn list of observed species into counts of how many different species observed
  

bird_2015_sp_graph <- ggplot(bird_2015_sp, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number of Species Observed", title = "Shorebird Diversity at COPR (2015)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #bar graph for number of species found in beach polygons 

#Maybe add a map to this page of polygons

bird_2015_sp_graph

```


```{r}
#Shorebird diversity by location for 2016

bird_2016_sp <- shorebirds %>% 
    filter(Year == "2016") %>% #Filter data set by year (use radio buttons or drop down menu to select)
  group_by(Species) %>% 
  count(Polygon_Location, Species) #Turn list of observed species into counts of how many different species observed
  

bird_2016_sp_graph <- ggplot(bird_2016_sp, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number of Species Observed", title = "Shorebird Diversity at COPR (2016)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #bar graph for number of species found in beach polygons 

#Maybe add a map to this page of polygons

bird_2016_sp_graph

```


```{r}
#Shorebird diversity by location for 2017

bird_2017_sp <- shorebirds %>% 
    filter(Year == "2017") %>% #Filter data set by year (use radio buttons or drop down menu to select)
  group_by(Species) %>% 
  count(Polygon_Location, Species) #Turn list of observed species into counts of how many different species observed
  

bird_2017_sp_graph <- ggplot(bird_2017_sp, aes(x=Polygon_Location))+
  geom_bar()+
  labs(x= "Location", y = "Number of Species Observed", title = "Shorebird Diversity at COPR (2017)")+ 
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5)) #bar graph for number of species found in beach polygons 

#Maybe add a map to this page of polygons

bird_2017_sp_graph

```


```{r}
#Add 2018 data when we get it
```

```{r}
# Wrangling data for top bird species

#Converted dates into standard formate
shorebirds$Date <- as.Date(shorebirds$Date, "%m/%d/%Y")

# Top species by year
top_by_year2 <- shorebirds %>%
  mutate( Month = month(Date)) %>%
  select(Month, Year, Species, Count) %>% 
  filter( Year == 2015) %>% 
  group_by(Species) %>% 
  summarize( count = sum(Count)) %>% 
  arrange(-count) %>% 
  head(as.numeric("4"))



# Monthly data filtered for top species by year
top_filtered2 <-  shorebirds %>%
  mutate( Month = month(Date)) %>%
  select(Month, Year, Species, Count) %>% 
  filter( Year == 2015) %>% 
  group_by(Month, Species)%>%
  summarise( count = sum(Count))%>% 
  arrange(Species, -count)

top_graph <- ggplot( top_filtered2[top_filtered2$Species %in% top_by_year2$Species,], aes( x = Month, y = count)) + geom_col() + 
facet_wrap(~Species) +
theme_classic() +
scale_x_continuous(breaks = c(1,2,3,4,5,6,7,8,9,10,11,12))

top_graph

```

